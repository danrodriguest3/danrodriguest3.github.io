<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Happy Birthday AR</title>
    <meta name="viewport"
        content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <meta name="referrer" content="origin-when-cross-origin" />
    <style>
        html,
        body,
        #root {
            height: 100%;
            width: 100%;
        }

        body {
            margin: 0px;
            border: 0px;
            overflow: hidden;
            background-color: #000000;
        }

        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @font-face {
            font-family: 'Helvetica Neue';
            src: url('fonts/helvetica/Helvetica\ Neue\ Medium\ Extended.otf');
        }

        @font-face {
            font-family: 'Helvetica Neue Light';
            src: url('fonts/helvetica/Helvetica\ Neue\ UltraLight.otf');
        }

        .inputLabel {
            color: white;
            font-family: 'Helvetica Neue';
            font-size: 5vw;
            flex: 1;
            align-items: center;
            display: flex;
            width: 80%;
            margin: auto;
        }

        .mainInput {
            border: none;
            width: 80%;
            height: 80%;
            text-align: center;
            font-size: 4.5vw;
            align-items: flex-start;
            display: flex;
            margin: auto;
        }

        .inputInstruction {
            color: white;
            font-family: 'Helvetica Neue';
            font-size: 4vw;
            text-align: center;
            align-self: self-end;
            flex: 1;
            display: flex;
        }

        .btnText {
            margin: auto;
            font-family: 'Helvetica Neue Light';
            font-weight: bold;
            letter-spacing: .25vw;
        }

        .action-bar-container {
            position: absolute;
            padding-inline: 10pt;
            bottom: 0;
            left: 0;
            width: -webkit-fill-available;
            height: 20%;
            background: #000000;
            z-index: -1;
        }

        .detail-line {
            background: #FF086E;
            width: 120px;
            height: 2px;
        }

        .action-bar-buttons {
            height: 70%;
            display: flex;
            justify-content: center;
        }

        .action-bar-button {
            display: flex;
            justify-content: center;
            flex-direction: column;
            align-items: center;
            align-content: center;
            background-color: rgba(0, 0, 0, 0.6);
            color: rgb(230, 230, 230);
            text-align: center;
            text-decoration: none;
            font-size: 14pt;
            flex: 1;
        }

        .action-bar-button svg {
            margin-bottom: 4pt;
            height: 32pt;
        }

        .spinner {
            border: 2vw solid #f3f3f3;
            /* Light grey */
            border-top: 2vw solid #3498db;
            /* Blue */
            border-radius: 50%;
            width: 10vw;
            height: 10vw;
            animation: spin 2s linear infinite;
            margin-inline: auto;
            margin-top: 100%;
        }

        .aframe-capsule {
            position: absolute;
            top: 0px;
            width: inherit;
            height: inherit;
        }

    </style>
    <script src="js/aframe.min.js"></script>
    <script src="js/aframe-particle-system-component.min.js"></script>
    <script type="module" src="js/FontLoader.js"></script>
    <script type="module" src="js/TextGeometry.js"></script>
    <script xmlns="http://www.w3.org/1999/xhtml" async=""
        src="https://cdn.rawgit.com/eligrey/FileSaver.js/5ed507ef8aa53d8ecfea96d96bc7214cd2476fd2/FileSaver.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155137525-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-155137525-2');
    </script>
    <script>
        const state = {
            running: false,
            handDetected: false,
            xpStarted: false,
            isMobile: false,
            handDetectionLoaded: false
        }
        const hands = new Hands({
            locateFile: (file) => {
                return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
            }
        });
        let videoElement, msg = document.getElementById('showHands');
        async function loadHandDetection() {
            if (!state.handDetectionLoaded) {
                document.getElementById('t3-spinner').style.display = 'block';
                const _feed = document.getElementById('input-video');
                await hands.setOptions({
                    maxNumHands: 1,
                    modelComplexity: 0,
                    minDetectionConfidence: 0.6,
                    minTrackingConfidence: 0.6,
                    selfieMode: false
                });

                const camera = await new Camera(videoElement, {
                    onFrame: async () => {
                        await hands.send({ image: videoElement })
                    },
                    width: _feed.width * 3,
                    height: _feed.height * 3,
                    facingMode: 'selfie'
                });
                hands.onResults(r => {
                    state.handDetected = r.multiHandLandmarks.length > 0;
                    updateState(r);
                });
                await camera.start();
            } else {
                document.getElementById('t3-spinner').style.display = 'none';
            }
            let _loader = setInterval(async () => {
                const _t3Loader = await document.getElementById('t3-loader');
                const _t3Op = await _t3Loader.style.opacity;
                if (_t3Op > 0) {
                    _t3Loader.style.opacity = _t3Op - 0.025;
                } else {
                    state.handDetectionLoaded = true;
                    document.getElementById('t3-loader').style.display = 'none';
                    document.getElementById('showHands').style.display = '';
                    _t3Loader.style.opacity = 1;
                    clearInterval(_loader);
                }
            }, 33.3);
        }
        AFRAME.registerComponent('autoscale', {
            init: function () {
                this.scale();
            },
            scale: function () {
                const el = this.el;
                const span = this.data;
                const mesh = el.getObject3D('mesh');

                if (!mesh)
                    return;

                // Compute bounds.
                const bbox = new THREE.Box3().setFromObject(mesh);

                // Normalize scale.
                const scale = span / bbox.getSize().length();
                mesh.scale.set(scale, scale, scale);

                // Recenter.
                const offset = bbox.getCenter().multiplyScalar(scale);
                mesh.position.sub(offset);
            }
        });
        function takePhoto() {
            document.getElementById('review_modal').style.display = 'inline';
            const myImgElem = document.getElementById('review-img');
            myImgElem.src = '';
            myImgElem.style.display = 'none';
            const canvas = document.getElementById('input-video');
            const frame = document.getElementById('frameDiv');
            html2canvas(canvas).then(function (canvas) {
                // Getting video and object as canvases
                var canvas_video = canvas.toDataURL();
                var canvas_objects = document.querySelector('[arjs]').components.screenshot.getCanvas('perspective').toDataURL();
                // ===================== Building composite canvas ====================== //
                var _canvas1 = document.getElementById('canvas1');
                _canvas1.height = canvas.height;
                _canvas1.width = canvas.width;
                var _ctx1 = _canvas1.getContext('2d');
                // Draw video background
                var img = new Image;
                img.onload = function () {
                    _ctx1.clearRect(0, 0, _canvas1.width, _canvas1.height);
                    _ctx1.drawImage(img, 0, 0, _canvas1.width, _canvas1.height, 0, 0, _canvas1.width, _canvas1.height);
                };
                img.src = canvas_video;
                // Draw 3d elements
                var ovr = new Image;
                ovr.onload = function () {
                    _ctx1.drawImage(ovr, 0, 0, ovr.width, ovr.height, 0, 0, img.width, img.height);
                }
                ovr.src = canvas_objects;
                // Draw Frame
                if (Array.from(frame.children).length) {
                    html2canvas(frame, { backgroundColor: null }).then(function (frame) {
                        var canvas_frame = frame.toDataURL();
                        var frm = new Image;
                        frm.onload = function () {
                            _ctx1.drawImage(frm, 0, 0, _canvas1.width, _canvas1.height);
                        }
                        frm.src = canvas_frame;
                        setTimeout(() => {
                            var _image = _canvas1.toDataURL("image/png");
                            myImgElem.src = _image;
                            document.getElementById('review-img').style.display = 'inline';
                        }, 250);
                    });
                } else {
                    setTimeout(() => {
                        var _image = _canvas1.toDataURL("image/png");
                        myImgElem.src = _image;
                        document.getElementById('review-img').style.display = 'inline';
                    }, 250);
                }
                // Get data from new canvas
            });
        }
        function resetPosition() {
            const _old_camera = document.querySelector('[camera]');
            const _sceneEl = document.querySelector('a-scene');
            const _obj = document.getElementById('3d-object');
            var _camera = document.createElement('a-entity');
            _sceneEl.appendChild(_camera);
            _camera.setAttribute('look-controls', 'enabled: true; selfieMode: true;');
            _camera.setAttribute('camera', 'active', true);
            _sceneEl.removeChild(_old_camera);
            _obj.setAttribute('autoscale', 1);
        }
        document.addEventListener('DOMContentLoaded', async () => {
            msg = await document.getElementById('showHands');
            videoElement = await document.getElementById('input-video');
            document.getElementById('confettiRL').object3D.visible = false;
            document.getElementById('confettiLR').object3D.visible = false;
            document.getElementById('confettiBL').object3D.visible = false;
            document.getElementById('confettiBR').object3D.visible = false;
            document.addEventListener('loaded', [rdnTx()]);
            state.isMobile = AFRAME.utils.device.isMobile();
            //alert('isMobile: ' + state.isMobile + ' | objectFit: ' + document.getElementById('input-video').style.objectFit);
            document.getElementById('t3-loader').style.zIndex = 0;
            document.getElementById('t3-spinner').style.display = 'none';
            document.getElementById('customBar').style.display === 'none' && (document.getElementById('customBar').style.display = 'block');
            setTimeout(() => document.querySelector('[camera]').setAttribute('look-controls', 'enabled: true; selfieMode: true;'), 500);
        });
        function closeReview() {
            document.getElementById('review_modal').style.display = 'none';
            document.getElementById('review-img').style.display = 'none';
            document.body.scrollTo(0, 0);
        }
        async function rdnTx() {
            const knownMat = [];
            const genMat = [];
            var obj = document.getElementById('3d-object');
            await obj.addEventListener('model-loaded', async (e) => {
                var _obj = await obj.getObject3D('mesh');
                let _index = 0;
                await _obj.traverse(async function (node) {
                    if (node.isMesh)
                        if (!knownMat.includes(node.material.name)) {
                            knownMat.push(node.material.name);
                            var tempCanvas = document.createElement('canvas');
                            var tempCtx = tempCanvas.getContext('2d');
                            tempCanvas.width = 256;
                            tempCanvas.height = 256;
                            var grd = tempCtx.createLinearGradient(0, 0, tempCanvas.width, 0);
                            const hs = [Math.random() * 360, Math.random() * 360];
                            const ss = [Math.floor(Math.random() * (70 + 1)), Math.floor(Math.random() * (70 + 1))];
                            const ls = [Math.floor((1 + Math.random()) * (70 / 2 + 1)), Math.floor((1 + Math.random()) * (70 / 2 + 1))];
                            grd.addColorStop(0, "hsl(" + hs[0] + ", " + ss[0] + "%, " + ls[0] + "%)");
                            grd.addColorStop(.5, "hsl(" + hs[1] + ", " + ss[1] + "%, " + ls[1] + "%)");
                            grd.addColorStop(1, "hsl(" + hs[0] + ", " + ss[0] + "%, " + ls[0] + "%)");
                            tempCtx.fillStyle = grd;
                            await tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                            var canvasTexture = await new THREE.CanvasTexture(tempCtx.canvas);
                            canvasTexture.name = 'birthdayCake' + _index;
                            genMat.push(canvasTexture);
                            node.material.map = canvasTexture;
                            node.material.needsUpdate = true;
                            _index++;
                        } else {
                            knownMat.map((_mat, index) => {
                                if (_mat === node.material.name) {
                                    node.material.map = genMat[index];
                                    node.material.needsUpdate = true;
                                }
                            });
                        }
                });
                for (let _i = 0; _i < 4; _i++) {
                    const _candleGeo = new THREE.CylinderGeometry(0.125, 0.125, 2.5, 5, 1);
                    const _candleMat = new THREE.MeshBasicMaterial({ color: '0xffff00' });
                    const _candleObj = new THREE.Mesh(_candleGeo, _candleMat);
                    _candleObj.position.y = 6.5;
                    _candleObj.position.x = _i - 2;
                    _obj.add(_candleObj);
                    const _candleFlame = document.createElement('a-entity');
                    _candleFlame.id = 'flame' + _i;
                    _candleFlame.setAttribute('particle-system', 'color: #EFaa22; velocityValue: 0 12 0; particleCount: 200; size: 0.1; maxAge: 1; velocitySpread: 4 6 4;');
                    _candleFlame.setAttribute('position', _i - 2 + ' 7 0');
                    obj.append(_candleFlame);
                }
            });
        }
        async function updateText() {
            const sc = await document.getElementById('textEntity');
            const ob = await sc.object3D;
            const st = document.getElementById('sceneText');
            const loader = new THREE.FontLoader();
            await loader.load('fonts/helvetiker_regular.typeface.json', async function (font) {
                const geometry = new THREE.TextGeometry(st.value.length > 0 ? st.value : 'NAME', {
                    font: font,
                    size: 80,
                    curveSegments: 16,
                    bevelEnabled: false
                });
                await geometry.computeBoundingBox();
                await geometry.computeVertexNormals();
                const material = new THREE.MeshBasicMaterial({ color: '#' + (Math.random() * 0xFFFFFF << 0).toString(16).padStart(6, '0') });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.name = 'genText';
                mesh.position.x = 0;
                const pn = Math.random();
                mesh.position.y = 1;
                mesh.position.z = 0;
                mesh.scale.x = .0025;
                mesh.scale.y = .0025;
                mesh.scale.z = .0005;
                mesh.castShadow = true;
                const at = document.getElementById('ageText');
                const ageometry = new THREE.TextGeometry('Happy ' + at.value + ' Birthday!', {
                    font: font,
                    size: 80,
                    curveSegments: 16,
                    bevelEnabled: false,
                });
                await ageometry.computeBoundingBox();
                await ageometry.computeVertexNormals();
                const amaterial = new THREE.MeshBasicMaterial({ color: '#' + (Math.random() * 0xFFFFFF << 0).toString(16).padStart(6, '0') });
                const amesh = new THREE.Mesh(ageometry, amaterial);
                amesh.name = 'agenText';
                amesh.position.x = 0;
                const apn = Math.random();
                amesh.position.y = .5;
                amesh.position.z = 0;
                amesh.scale.x = .0025;
                amesh.scale.y = .0025;
                amesh.scale.z = .0005;
                amesh.castShadow = true;
                const aoldT = await ob.children.find(function (el) {
                    return el.name == 'agenText';
                });
                if (aoldT) {
                    ob.remove(aoldT);
                }
                const atxtBounds = ageometry.boundingBox;
                amesh.position.x = await -((atxtBounds.max.x - atxtBounds.min.x) * amesh.scale.x / 2);
                ob.add(amesh);
                // Add new 3d text to scene
                const oldT = ob.children.find(function (el) {
                    return el.name == 'genText';
                });
                if (oldT) {
                    await ob.remove(oldT);
                }
                const txtBounds = geometry.boundingBox;
                mesh.position.x = await -((txtBounds.max.x - txtBounds.min.x) * mesh.scale.x / 2);
                await ob.add(mesh);
            });
        }
        const swipeArr = [], senseY = 3, senseX = 2;
        let swipeLoaded = false, finishedRunning = true;
        async function updateState(r) {
            const text = document.getElementById('textEntity');
            state.running
                && (state.handDetected
                    && (finishedRunning = false, state.running = false, msg.style.display = 'none', !state.xpStarted && checkAnim()));
            if (finishedRunning && r.multiHandWorldLandmarks.length > 0 && document.getElementById('customBar').style.display === 'none') {
                finishedRunning = false;
                if (!swipeLoaded) {
                    if (swipeArr.length < 3) {
                        swipeArr.push({ r: r, active: false });
                    } else {
                        swipeArr.push({ r: r, active: true });
                        swipeLoaded = true;
                    }
                }
                await swipeArr.map(async (pos, index) => {
                    if (pos.active) {
                        const _r = pos.r;
                        swipeArr.splice(index, 1, { r: _r, active: false });
                        swipeArr[index].active = false;
                        if (index < swipeArr.length - 1) {
                            swipeArr.splice(index + 1, 1, { r: r, active: true });
                            swipeArr[index + 1].r = r;
                            swipeArr[index + 1].active = true;
                        } else {
                            swipeArr.splice(0, 1, { r: r, active: true });
                            swipeArr[0].r = r;
                            swipeArr[0].active = true;
                        }
                        if (swipeArr[index + 1]) {
                            if (swipeArr[index + 2]) {
                                if (Math.abs(swipeArr[index + 1].r.multiHandWorldLandmarks[0][0].x - swipeArr[index + 2].r.multiHandWorldLandmarks[0][0].x) * 1000 > senseX || Math.abs(swipeArr[index + 1].r.multiHandWorldLandmarks[0][0].y - swipeArr[index + 2].r.multiHandWorldLandmarks[0][0].y) * 1000 > senseY) {
                                    confettiCannons();
                                } else {
                                    finishedRunning = true;
                                }
                            } else {
                                if (Math.abs(swipeArr[index + 1].r.multiHandWorldLandmarks[0][0].x - swipeArr[0].r.multiHandWorldLandmarks[0][0].x) * 1000 > senseX || Math.abs(swipeArr[index + 1].r.multiHandWorldLandmarks[0][0].y - swipeArr[0].r.multiHandWorldLandmarks[0][0].y) * 1000 > senseY) {
                                    confettiCannons();
                                } else {
                                    finishedRunning = true;
                                }
                            }
                        } else {
                            if (Math.abs(swipeArr[0].r.multiHandWorldLandmarks[0][0].x - swipeArr[swipeArr.length - 1].r.multiHandWorldLandmarks[0][0].x) * 1000 > senseX || Math.abs(swipeArr[0].r.multiHandWorldLandmarks[0][0].y - swipeArr[swipeArr.length - 1].r.multiHandWorldLandmarks[0][0].y) * 1000 > senseY) {
                                confettiCannons();
                            } else {
                                finishedRunning = true;
                            }
                        }
                    } else {
                        r && (finishedRunning = true);
                    }
                });
            }
        }
        async function confettiCannons() {
            !msg.style.display && (msg.style.display = 'none');
            await swipeArr.slice(0, 1);
            await swipeArr.splice(0, 1, { r: null, active: false });
            document.getElementById('confettiRL').object3D.visible = true;
            document.getElementById('confettiLR').object3D.visible = true;
            document.getElementById('confettiBL').object3D.visible = true;
            document.getElementById('confettiBR').object3D.visible = true;
            document.getElementById('confettiBL').setAttribute('particle-system', 'color: #EFaa22; velocityValue: 6 12 -9; particleCount: 450; size: 0.35; duration: 4;');
            document.getElementById('confettiBR').setAttribute('particle-system', 'color: #EFaa22; velocityValue: -6 12 -9; particleCount: 450; size: 0.35; duration: 4;');
            const _obj = document.getElementById('3d-object');
            for (let _i = 0; _i < 4; _i++) {
                const _flame = document.getElementById('flame' + _i);
                _flame && _obj.removeChild(_flame);
            }
        }
        function checkAnim() {
            state.xpStarted = true;
            const cake = document.getElementById('3d-object');
            const text = document.getElementById('textEntity');
            cake.dispatchEvent(new Event('startAnim'));
            text.dispatchEvent(new Event('startAnim'));
            text.setAttribute('position', '0 2 -3');
            document.getElementById('t3-loader').style.zIndex = -1;
            console.log(state.xpStarted, state);
            setTimeout(() => {
                msg.style.display = '';
                msg.children.item(0).innerHTML = 'Swipe your hand in front of you to get a surprise! Make a wish!';
                finishedRunning = true;
            }, 4000);
            /** Swipe your hand across your back camera to get A surprise! Make a wish! **/
        }
        function setVisible() {
            const bar = document.getElementById('customBar');
            const name = document.getElementById('sceneText').value;
            document.scrollingElement.scrollTo(0, -100);
            if (name)
                if (bar.style.display !== 'none') {
                    bar.style.display = 'none';
                    state.running = true;
                } else {
                    bar.style.display = 'block';
                    state.running = false;
                } else alert('You forgot to enter your name');
        }
        function handleInputState(el, value) {
            document.scrollingElement.scrollTo(0, -100);
            const _subBtn = document.getElementById('subBtn');
            if (value.length > 0) {
                _subBtn.removeAttribute('disabled');
                _subBtn.style.backgroundColor = 'FF006E';
            } else {
                _subBtn.setAttribute('disabled', 'true');
                _subBtn.style.backgroundColor = '633946';
            }
        }
    </script>
</head>

<body>
    <div id="customBar"
        style="position: absolute; top: 20%; left: 14%; width: 72%; height: 60%; background-color: #0fb3ffd7; border-radius: 9pt; z-index: 1; display: none;">
        <div style=" display: flex; flex-direction: column; width: 100%; height: 100%; justify-content: space-evenly">
            <div style="flex: 1; display: flex;">
                <div style="width: 80%; flex: 1; display: flex; flex-direction: column; padding-top: 10%;">
                    <label for="sceneText" class="inputLabel">Enter Your Name</label>
                    <div style="flex: 1;">
                        <input class="mainInput" type="text" id="sceneText" name="sceneText" placeholder="NAME"
                            maxlength="24" onfocus="handleInputState(this, this.value)"
                            onblur="handleInputState(this, this.value)"
                            onkeyup="this.value = this.value.toLocaleUpperCase(), handleInputState(this, this.value)">
                    </div>
                </div>
            </div>
            <div style="flex: 1; display: flex;">
                <div style="width: 80%; flex: 1; display: flex; flex-direction: column; padding-top: 10%;">
                    <label for="ageText" class="inputLabel">Your Age</label>
                    <div style="flex: 1;">
                        <input class="mainInput" type="text" id="ageText" name="ageText" placeholder="AGE" maxlength="3"
                            onfocus="handleInputState(this, this.value)" onblur="handleInputState(this, this.value)"
                            onkeyup="this.value = this.value.toLocaleUpperCase()">
                    </div>
                </div>
            </div>
            <div style="flex: 1; display: flex;">
                <div style="width: 80%; flex: 1; display: flex; height: inherit;">
                    <p class="inputInstruction">
                        Please turn up audio for the best experience.
                    </p>
                </div>
            </div>
            <div style="flex: 1;">
                <button id="subBtn" disabled="true" onclick="setVisible(), updateText(), loadHandDetection()"
                    style="display: flex; margin: auto; width: 50%; height: inherit; background-color: #633946; color: white; padding-block: 10pt;">
                    <p class="btnText">SUBMIT</p>
                </button>
            </div>
        </div>
    </div>
    <div id="showHands"
        style="position: absolute; bottom: 21%; left: 20%; width: 60%; background-color: #0FB5FF; color:#f3f3f3; text-align: center; display: none; border-radius: 9pt; z-index: 1; padding-inline: 14pt;">
        <h3>To begin hold a single hand up in front of you.</h3>
        <img src="img/icon_hand.svg" />
    </div>
    <div style="position: absolute; top: 0px; width: 100%; height: 100%; background-color: transparent; z-index: 0;">
        <div style="width: 100%; height: 80%; margin: 0">
            <div class='aframe-capsule'>
                <!-- AFRAME -->
                <a-scene id="scene" arjs embedded renderer="logarithmicDepthBuffer: true; antialias: true;"
                    vr-mode-ui="enabled: false"
                    gltf-model="dracoDecoderPath: https://www.gstatic.com/draco/v1/decoders/;">
                    <a-assets timeout="15000">
                        <a-asset-item id="model" src="models/t3cake.glb"></a-asset-item>
                    </a-assets>
                    <a-entity id="capsule">
                        <a-entity id="textEntity" position="0 80 -4">
                        </a-entity>
                        <a-entity id="confettiRL"
                            particle-system="accelerationSpread: 10 0 10; color: #fff; particleCount: 1000; opacity: 1; preset: default; size: 0.75; velocityValue: 0 15 0"
                            position="5.584 1.250 1">
                        </a-entity>
                        <a-entity id="confettiLR"
                            particle-system="accelerationSpread: 10 0 10; color: #fff; particleCount: 1000; opacity: 1; preset: default; size: 0.75; velocityValue: 0 15 0"
                            position="-5.584 1.250 1">
                        </a-entity>
                        <a-entity id="confettiBL" position="-1 0 0">
                        </a-entity>
                        <a-entity id="confettiBR" position="1 0 0">
                        </a-entity>
                        <a-entity id="3d-object" gltf-model="#model" animation-mixer class="clickable" autoscale
                            material="color: red" position="0 40 0" scale=".125 .125 .125"
                            animation__1="property: position; from: 0 1 -4; to: 0 0.5 -4; dur: 4000; startEvents: startAnim, animationcomplete__2"
                            animation__2="property: position; from: 0 0.5 -4; to: 0 1 -4; dur: 4000; startEvents: animationcomplete__1"
                            animation__3="property: rotation; from: 0 0 0; to: 0 360 0; dur: 8000; loop: true; easing: linear">
                        </a-entity>
                    </a-entity>
                    <a-entity cursor="fuse: false;" raycaster="objects: .clickable">
                    </a-entity>
                </a-scene>
            </div>
            <div id="frameDiv"
                style="position: absolute; top: 0px; width: inherit; height: inherit; background-color: transparent;">
                <!-- Frame -->
                <div style="position: absolute; top: 0px; width: inherit; height: 2vw; background: #0FB5FF;"></div>
                <img src="img/icon_flags.svg" width="100%"
                    style="position: absolute; top: 0%; left: 0%; object-fit: fill;" />
                <div style="position: absolute; top: 0px; left: 0px; width: 2vw; height: 100%; background: #0FB5FF;">
                </div>
                <div style="position: absolute; top: 0px; right: 0px; width: 2vw; height: 100%; background: #0FB5FF;">
                </div>
                <div id="logoBG"
                    style="position: absolute; top: 0px; left: 41.25%; width: 17.5%; height: 7.109%; background: #0FB5FF;">
                    <img src="/img/logo.png" width="100%" height="80%"
                        style="object-fit: scale-down; margin-top: 7.5%;" />
                </div>
                <div style="position: absolute; right: 0px; bottom: -20px; width: 30%; z-index: -1">
                    <img src="img/icons_balloons_one.svg"
                        style="background: transparent; object-fit: fill; width: 100%;" />
                </div>
                <div style="position: absolute; left: 0px; bottom: -30px; width: 30%; z-index: -1">
                    <img src="img/icon_ballons_two.svg"
                        style="background: transparent; object-fit: fill; width: 100%;" />
                </div>
                <div style="position: absolute; bottom: 0px; width: inherit; height: 2vw; background: #0FB5FF;"></div>
            </div>
        </div>
        <!-- ACTION BAR -->
        <div class="action-bar-container">
            <div
                style="width: 95%; height: 20%; margin: 0; display: flex; align-items: center; justify-content: center;">
                <div class="detail-line"></div>
            </div>
            <div class="action-bar-buttons">
                <button class="action-bar-button" onclick="resetPosition()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="27.028" height="30.494" viewbox="0 0 27.028 30.494">
                        <path id="icon_reset"
                            d="M132.44,14h-9.373a8.843,8.843,0,0,0-8.827,8.827v7.7a1.284,1.284,0,1,0,2.568,0v-7.7a6.233,6.233,0,0,1,6.227-6.227h9.341a6.247,6.247,0,0,1,6.291,6.227v6.741A6.233,6.233,0,0,1,132.44,35.8H120.852l3.884-3.884a1.294,1.294,0,0,0-1.83-1.83l-6.1,6.1a1.279,1.279,0,0,0,0,1.83l6.1,6.1a1.285,1.285,0,0,0,.931.385,1.339,1.339,0,0,0,.931-.385,1.279,1.279,0,0,0,0-1.83L120.852,38.4H132.44a8.822,8.822,0,0,0,8.827-8.827V22.827A8.843,8.843,0,0,0,132.44,14Z"
                            transform="translate(-114.24 -14)" fill="#f8f93a" />
                    </svg>
                    Reset
                </button>
                <button class="action-bar-button" onclick="takePhoto()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="29" viewbox="0 0 35 29">
                        <g id="icon_camera" transform="translate(-0.5 -3.5)">
                            <path id="Path_2915" data-name="Path 2915"
                                d="M34.5,28.5a3,3,0,0,1-3,3H4.5a3,3,0,0,1-3-3V12a3,3,0,0,1,3-3h6l3-4.5h9l3,4.5h6a3,3,0,0,1,3,3Z"
                                fill="none" stroke="#ffe900" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2" />
                            <path id="Path_2916" data-name="Path 2916" d="M24,19.5a6,6,0,1,1-6-6,6,6,0,0,1,6,6Z"
                                fill="none" stroke="#0fb5ff" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="1" />
                        </g>
                    </svg>
                    Take A Photo
                </button>
            </div>
        </div>
    </div>
    <!-- TEMPORARY CANVAS USED TO BUILD FINAL IMAGE -->
    <canvas style="position: relative; top: 0px; left: 0px; z-index: -3;" id="canvas1">
    </canvas>
    <canvas style="position: relative; top: 0px; left: 0px; z-index: -3; width: 100%; height: 100%;" id="canvas2">
    </canvas>
    <!-- REVIEW VIEW -->
    <div id="review_modal" style="
		position: absolute; 
		top: 0px; 
		left: 0px; 
		width: 100%; 
		height: 100%; 
		background-color: rgb(255,255,255);
		display: none;
		z-index: 2;">
        <div
            style="width: 100%; padding-top: 16px; padding-bottom: 16px; padding-left: 8px; background-color: rgba(0,0,0,.6); pointer-events: none;">
            <button onclick="closeReview()" style="
				background-color: rgba(0,0,0,.6);
				border: solid;
				border-radius: 12px;
				border-width: 1px;
				color: rgb(230,230,230);
				padding: 8px 8px;
				text-align: center;
				text-decoration: none;
				font-size: 12px;
				pointer-events: auto;">Back</button>
        </div>
        <div style="width: 100%;">
            <div id="loader" style="
				position: absolute; 
				top: 25%; 
				z-index: -1;
				left: 50%;
				margin-left: -40px;
				border: 10px solid #f3f3f3;
				border-radius: 50%;
				border-top: 10px solid #00ff00;
				width: 80px;
				height: 80px;
				-webkit-animation: spin 2s linear infinite; /* Safari */
				animation: spin 2s linear infinite;"></div>
            <img id="review-img" style="width: 100%; pointer-events: auto;" />
            <div style="width: 90%; margin: auto; pointer-events: none;">
                <p style="text-align: center;">Tap and hold on the image to save to your photos or share</p>
            </div>
        </div>
    </div>
    <div id="t3-loader"
        style="position: absolute; width: 100%; height: 100%; z-index: 3; background: #0fb3ffd2; top: 0px; left: 0px; backdrop-filter: blur(4px); opacity: 1;">
        <div id="t3-spinner" class="spinner"></div>
    </div>
    <video autoplay="" muted="" playsinline="" id="input-video" width="100%" height="80%"
        style="position: absolute; top: 0px; left: 0px; z-index: -2; object-fit: fill;"></video>
</body>

</html>
